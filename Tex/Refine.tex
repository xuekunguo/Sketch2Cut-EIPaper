
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{候选部件优化}
候选部件优化是可选项，不会对最终造型结果有太大影响。

我们首先得到ROI区域$\Omega_{obj}$与$\Omega_{obj}'$在数据库模型上，通过扩展初始切割线，在初始候选部件的内部与外部，扩展长度为$0.1 l_{dia}$。
$l_{dia}$表示候选部件包围盒对角线的长度。代理部件的ROI区域$\Omega_{proxy}$用类似方法得到。
接着，我们大致地对齐$\Omega_{obj}$和$\Omega_{proxy}$。我们将候选部件优化问题形式化成能量优化问题，其目标函数如下：
\[E\left( X \right) = \sum\limits_{{v_i} \in {\nu ^f}} {{E_d}\left( {{x_{{v_i}}}} \right) + \sum\limits_{\left( {{v_i},{v_j}} \right) \in {\varepsilon ^f}} {{E_s}\left( {{x_{{v_i}}},{x_{{v_j}}}} \right)} ,} \]
其中$G^f = \left( \nu^f, \varepsilon^f \right)$是${\Omega _{obj}} \cup \Omega'_{obj}$的对偶图。$\nu^f$是顶点集合。$\varepsilon^f$是边集合。
${\rm X} = \left\{ {{x_{{v_i}}}|{v_i} \in \nu } \right\}$（$x_{v_i} = \left\{ 0, 1 \right\}$）是$G^f$的一个标记。$E_d \left(x_{v_i} \right)$是数值项，表示将
标记$x_{v_i}$置给$v_i$的能量耗费，定义如下：
\[{E_d}\left( {{x_{{v_i}}}} \right) = \left\{ {\begin{array}{*{20}{c}}
   { - \ln {D_{obj}}\left( {{v_i}} \right),} & {{x_{{v_i}}} = 1,}  \\
   { - \ln \left( {1 - {D_{obj}}\left( {{v_i}} \right)} \right),} & {{x_{{v_i}}} = 0,}  \\
\end{array}} \right.\]
其中$D_{obj} \left(v_i \right)$表示将标记1置给$v_i$的概率，定义如下：
\[{D_{obj}}\left( {{v_i}} \right) = {\omega _c}{g_c}\left( {{v_i}} \right) + {\omega _s}{g_s}\left( {{v_i}} \right),\]
其中$\omega_c = 0.5 + 0.2d$（$d$表示$v_i$与初始切割线间距）。$\omega_s = 1 - \omega_c$（$\omega_s \ge 0$）。
$g_s \left( v_i \right)$是$v_i$与$\Omega_{proxy}$间距，定义如下：
\[{g_c}\left( {{v_i}} \right) = \left\{ {\begin{array}{*{20}{c}}
   {\frac{{vol\left( {{\Omega _{obj}}} \right)}}{{vol\left( {{\Omega _{proxy}}} \right)}},} & {{v_i} \in {\Omega _{obj}},}  \\
   {\frac{{vol\left( {\Omega {'_{obj}}} \right)}}{{vol\left( {{\Omega _{proxy}}} \right)}},} & {{v_i} \in \Omega {'_{obj}},}  \\
\end{array}} \right.\]
$V \left( \cdot \right)$计算OBB的体积。$E_s \left( x_{v_i}, x_{v_j} \right)$是光滑项，计算相邻顶点$v_i$与$v_j$具有相同标记的能量耗费，定义如下：
\[{E_s}\left( {{x_{{v_i}}},{x_{{v_j}}}} \right) = \left\{ {\begin{array}{*{20}{c}}
   {0,} & {{x_{{v_i}}} = {x_{{v_j}}},}  \\
   {\exp \left( {\frac{{2\theta }}{\pi }} \right)} & {{x_{{v_i}}} \ne {x_{{v_j}}},}  \\
\end{array}} \right.\]
其中$\theta  \in \left[ {0,\frac{\pi }{2}} \right]$是相邻面片$v_i$与$v_j$的公共边与候选部件分割线的拟合平面间的夹角。 