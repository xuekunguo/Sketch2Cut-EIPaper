

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{快速匹配数据结构}

我们将三维模型局部匹配问题转化为多视角下的二维轮廓局部匹配问题。为此，我们为代理模型及数据库模型提取多个视角下的轮廓。
代理模型与数据库模型的局部匹配就是两者轮廓的局部匹配。
我们方法的最大挑战是快速地在数据库模型轮廓内找到与代理模型轮廓相匹配的轮廓段。
将代理模型轮廓逐一地与数据库模型轮廓做匹配明显不可行，因为匹配时间会随模型数据库的增大而急剧增加。
因此，我们提出一个轮廓索引数据结构来加速轮廓匹配过程。

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{轮廓描述符}\label{SubSecCtourDesc}
轮廓匹配以轮廓描述符匹配的形式实现。我们采用~\cite{GuoSGP2016,Riemenschneider2010}提出的轮廓描述符。
该轮廓描述符描述了轮廓上采样点的分布情况。为了提取轮廓描述符，我们首先在轮廓上等距采样，得到一组采样点。
然后，对任意一对采样点$\left(b_i, b_j \right)$，我们计算其角度描述符$\alpha_{ij}$（如图~\ref{FigAngleDesc}）：
\[{\alpha _{ij}} = \left\{ {\begin{array}{*{20}{c}}
{\left\langle {\overline {{b_i}{b_j}} ,\overline {{b_i}{b_{i + \Delta }}} } \right\rangle } & {\text{if~} i < j,}  \\
{\left\langle {\overline {{b_i}{b_j}} ,\overline {{b_i}{b_{i - \Delta }}} } \right\rangle } & {\text{if~} i > j,}  \\
0 & {\text{if~} \left\| {i - j} \right\| \le \Delta }  \\
\end{array}} \right.\]
其中$\Delta=4$是偏移量，$\left\langle l_1, l_2 \right\rangle$代表直线$l_1$与$l_2$间的夹角。
轮廓上所有采样点对的角度描述符构成的矩阵即为轮廓描述符$\bf A$（$A_{ij}=\alpha_{ij}$）。
轮廓$S$与$S'$做匹配形式化为：
\begin{equation}\label{EquCtourMatch}
J\left( {{\bf{A}},{\bf{A}}'} \right) = \mathop {\min }\limits_k \frac{1}{{{N^2}}}\sum\limits_{i = 0}^{N - 1} {\sum\limits_{j = 0}^{N - 1} {{{\left( {{{\bf{A}}_{\left[ {k + i,k + j} \right]}} - {\bf{A}}{'_{\left[ {i,j} \right]}}} \right)}^2}} } ,
\end{equation}
其中$\bf A$是轮廓$S$的描述符，大小为$M \times M$；${\bf A}'$是轮廓$S'$的描述符，大小为$N \times N$（$N \le M$）。
${\bf A}_{\left[,\right]}$与${\bf A}'_{\left[,\right]}$是矩阵的元素。$S$内起点为$k+i$终点为$k+j$的轮廓段是$S$上与$S'$相匹配的轮廓段。
$J \left( {\bf A}, {\bf A'} \right)$是$S$与$S'$间的差异程度。差异程度越小表示两者越相似。
%--------------------------
\begin{figure}\centering
\includegraphics[width=\linewidth]{./Mat/AngleDesc.pdf}
\caption{角度描述符示意图。}\label{FigAngleDesc}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{建立轮廓索引}
在预处理阶段，我们为数据库模型提取$T_M = 14$个视角下的轮廓（boundary contours）~\cite{DeCarlo2003}，包括6个规范视角（Canonical side views），8个角视角（Corner views）。
通过这种方式，我们得到数据库模型的二维轮廓${\Gamma _M} = \left\{ {{S_i}|1 \le i \le {T_M}} \right\}$（$S_i$表示第$i$个视角下的轮廓）。

对数据库模型的轮廓，我们按采样距离$\Theta  = \left\{ {3,6,9,12,15} \right\}$得到一组轮廓描述符。
然后，我们基于轮廓差异程度将数据库模型所有的轮廓组织到$k$NN图~\cite{Seb2002}内。
图的顶点表示模型轮廓。对每一个顶点，我们将与之最匹配的30个顶点连接。
两轮廓的匹配程度及对应关系存储在顶点间的边上。

接着，我们在图上采样一组种子点。我们随机选择一个顶点做为种子点，然后采用最好优先（best-first search）方法遍历全图。
如果当前顶点与种子点的差异值高于0.7，当前顶点做为新的种子点。遍历过程重新开始。如上过程不断重复，直至所有顶点被访问到。
通过这种方式，我们从$k$NN图内采样出一组种子点。

为了加速遍历过程，我们仅遍历与当前数据库模型最相似的模型的轮廓。
最相似的模型通过三维模型分布描述符（3D shape distribution）~\cite{Funkhouser2003}计算得到（我们取与当前模型最相似的前80个模型）。

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{轮廓索引辅助的轮廓匹配}
在搜索阶段，给一个代理模型轮廓$C$，我们首先将它与所有的种子轮廓做匹配。匹配结果存储在优先队列内，并按匹配分数升序排列。
接着，以最好优先方式遍历整个$k$NN图：优先队列队顶出队，将其邻居与$C$做匹配，匹配结果入队。该过程中，我们可以利用边上的对应信息，快速确定当前轮廓与$C$相匹配的轮廓段（称为初始轮廓段）。
为了降低积累误差，我们进一步优化初始轮廓段：1）将初始轮廓段延伸至$0.3N_{frag}$（$N_{frag}$是初始轮廓段的长度）的长度；2）在延伸轮廓段上找到与$C$相匹配的部分，即为最终匹配轮廓段。
为了进一步加速匹配过程，匹配分数大于$0.9$的顶点被丢弃。