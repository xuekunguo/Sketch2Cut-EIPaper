

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{快速匹配数据结构}

我们将三维模型局部匹配问题转化为多视角下的二维轮廓局部匹配问题。为此，我们为代理模型及数据库模型提取多个视角下的轮廓。
通过代理模型轮廓与数据库模型轮廓的二维局部匹配实现三维模型的局部匹配。在我们的方法中一个最大的挑战是快速地在数据库模型轮廓内找到与代理模型轮廓相匹配的轮廓段。
一个接一个地比较代理模型轮廓与各数据库模型轮廓明显不可行，因为匹配时间会随数据库模型数量的增大而急剧增大。
因此，我们需要设计一个可扩展性的方法。我们开发了一个轮廓索引数据库结构来加速三维模型局部匹配。

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{轮廓描述符}\label{SubSecCtourDesc}
我们采用角度矩阵做为轮廓描述符~\cite{GuoSGP2016,Riemenschneider2010}。
角度矩阵描述了轮廓上采样点间的空间分布。为了提取轮廓描述符，我们首先对轮廓等距离采样，得到一组采样点。对任意一对采样点$\left(b_i, b_j \right)$，我们计算其角度描述符$\alpha_{ij}$（如图~\ref{FigAngleDesc}）：
\[{\alpha _{ij}} = \left\{ {\begin{array}{*{20}{c}}
{\left\langle {\overline {{b_i}{b_j}} ,\overline {{b_i}{b_{i + \Delta }}} } \right\rangle } & {\text{if~} i < j,}  \\
{\left\langle {\overline {{b_i}{b_j}} ,\overline {{b_i}{b_{i - \Delta }}} } \right\rangle } & {\text{if~} i > j,}  \\
0 & {\text{if~} \left\| {i - j} \right\| \le \Delta }  \\
\end{array}} \right.\]
其中$\Delta=4$是偏移量，$\left\langle l_1, l_2 \right\rangle$代表直线$l_1$与$l_2$间的夹角。所有采样点对的角度描述符构成的矩阵$A$（$A_{ij}=\alpha_{ij}$）为轮廓描述符。
两轮廓$S$与$S'$的差异值定义为：
\begin{equation}\label{EquCtourMatch}
J\left( {{\bf{A}},{\bf{A}}'} \right) = \mathop {\min }\limits_k \frac{1}{{{N^2}}}\sum\limits_{i = 0}^{N - 1} {\sum\limits_{j = 0}^{N - 1} {{{\left( {{{\bf{A}}_{\left[ {k + i,k + j} \right]}} - {\bf{A}}{'_{\left[ {i,j} \right]}}} \right)}^2}} } ,
\end{equation}
其中$\bf A$是$S$的轮廓描述符，大小为$M \times M$；${\bf A}'$是$S$的轮廓描述符，大小为$N \times N$（$N \le M$）。
${\bf A}_{\left[,\right]}$是矩阵的元素。$S$内起点为$k+i$终点为$k+j$的轮廓段是$S$上与$S'$相匹配的轮廓段。
%--------------------------
\begin{figure}\centering
\includegraphics[width=\linewidth]{./Mat/AngleDesc.pdf}
\caption{角度描述符示意图。}\label{FigAngleDesc}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{建立轮廓索引}
在预处理阶段，我们为数据库模型提取$T_M = 14$个视角下的轮廓（boundary contours）~\cite{DeCarlo2003}，包括6个规范视角，8个角视角。
通过这种方式，我们得到数据库模型的的二维轮廓${\Gamma _M} = \left\{ {{S_i}|1 \le i \le {T_M}} \right\}$，$S_i$表示第$i$个视角下的轮廓。

对数据库模型的每一个轮廓，我们按不同的采样距离等距采样，得到一组采样轮廓，每个采样轮廓称为一个点轮廓。
我们首先建立一个$k$NN图~\cite{Seb2002}，为了数据库内所有模型轮廓，基于它们的匹配程度。 图的顶点表示模型轮廓，对每一个顶点，我们将与之最相似的$k = 30$个顶点连接在一起。匹配分数及两轮廓内采样点间的对应关系存储在对应边上。

接着，我们在图上采样出一组种子点。我们随机地选择一个顶点做为种子，然后采用最好优化（best-first search）方法遍历该图。
当前顶点与种子点的匹配分数高于一个阈值$\delta_c = 0.7$时，当前顶点做为种子点。我们以当前顶点为起点开始遍历过程。
该遍历过程不断重复，直至所有顶点被访问到。通过这种方式，我们从$k$NN图内采样出一组种子点。

为了加速建立轮廓层次索引数据结构，我们首先过滤掉不相似的三维模型，通过比较它们的三维模型分布（3D shape distribution）~\cite{Funkhouser2003}。
接着，索引在最相似的80个模型的轮廓上建立。

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{轮廓索引辅助的轮廓匹配}
在运行中，给一个代理模型轮廓$E_C$，我们首先将它与所有的种子轮廓相匹配。匹配结果存在在优先队列内，并按匹配分数升序排列。
我们接着遍历$k$NN图通过最好优先方式。优先队列队顶出队，其邻居与$E_C$相比较，并入队。此时，我们利用预存储在图内边上的对应信息，可以快速地确定数据库轮廓上与$E_C$相
匹配的初始轮廓段。为了降低误差积累，我们进一步优化初始轮廓段，通过一个简单的初始轮廓段优化方法。具体地讲，我们首先将初始轮廓段延伸至$0.3N_{frag}$（$N_{frag}$是初始轮廓段的长度）。
接着，我们在延伸轮廓段上找到与$E_C$相匹配的部分，即为最终匹配轮廓段。为了进一步加速匹配过程，我们将匹配分数大于$0.9$的顶点去掉。